
<DOCTYPE html>
<html lang="en">
    <head>
        <title> Question A - Three.js scene</title>
        <meta charset="utf-8">
        <style>
            body {margin:0;}
            canvas{width:100%; height:100%}
        </style>
        <script src="../three.js"></script>
        <script src="Driver.js"></script>
        <script id="phong-vs" type="x-shader/x-vertex">
            precision mediump float;

            uniform mat4 modelMatrix;
            uniform mat4 viewMatrix;
            uniform mat4 projectionMatrix;

            attribute vec3 position;
            attribute vec3 normal;

            uniform vec3 l1_pos;
            uniform vec3 l2_pos;
            uniform vec3 l3_pos;

            varying vec3 norm, l1, l2, l3, view_vec;

            void main(){
                // shift to cam coords
                vec4 pos = viewMatrix * modelMatrix * vec4(position, 0.0);
                vec3 p = pos.xyz;
                view_vec = normalize(-p) ;
                norm =vec3( normalize(viewMatrix * modelMatrix * vec4(normal.xyz, 0.0) ).xyz);
                vec4 l1_cam = viewMatrix * vec4(l1_pos, 1.0);
                vec4 l2_cam = viewMatrix * vec4(l2_pos, 1.0);
                vec4 l3_cam = viewMatrix * vec4(l3_pos, 1.0);
                l1 = vec3(normalize(l1_cam - pos).xyz);
                l2 = vec3(normalize(l2_cam - pos).xyz);
                l3 = vec3(normalize(l3_cam - pos).xyz);
                gl_Position =projectionMatrix * pos;
            }

        </script>

        <script id="phong-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec3 norm, l1, l2, l3, view_vec;
            float shininess = 32.0;

            uniform vec3 l1_diff, l2_diff, l3_diff;
            uniform vec3 l1_spec, l2_spec, l3_spec;

            void main(){
                vec4 outColor1 = vec4(0.0);
                vec4 outColor2 = vec4(0.0);
                vec4 outColor3 = vec4(0.0);

                float diff1 = max(0.0, dot(norm, l1));
                vec3 color1 = diff1 * l1_diff;

                vec3 r1 = normalize(reflect(-l1, norm));
                float spec1 = pow(max(0.0, dot(r1, view_vec)), shininess);

                color1 += spec1 * l1_spec;
                if(spec1 > 1.0){
                    outColor1 = vec4(l1_spec, 1.0);
                } else {
                    outColor1 = clamp(vec4(color1, 1.0), 0.0, 1.0);
                }

                float diff2 = max(0.0, dot(norm, l2));
                vec3 color2 = diff2 * l2_diff;

                vec3 r2 = normalize(reflect(-l2, norm));
                float spec2 = pow(max(0.0, dot(r2, view_vec)), shininess);

                color2 += spec2* l2_spec;
                if(spec2  > 1.0){
                    outColor2 = vec4(l2_spec, 1.0);
                } else {
                    outColor2 = clamp(vec4(color2, 1.0), 0.0, 1.0);
                }

                float diff3 = max(0.0, dot(norm, l3));
                vec3 color3 = diff3 * l3_diff;

                vec3 r3 = normalize(reflect(-l3, norm));
                float spec3 = pow(max(0.0, dot(r3, view_vec)), shininess);

                color3 += spec3* l3_spec;
                if(spec3 > 1.0){
                    outColor1 = vec4(l3_spec, 1.0);
                } else {
                    outColor3 = clamp(vec4(color3, 1.0), 0.0, 1.0);
                }

                //gl_FragColor = clamp(vec4(0.1,0.1,0.1, 1.0) +  outColor1 + outColor2 + outColor3, 0.0, 1.0);
                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
            }
        </script>

    <head>
    <body onload="main()">
        <div id="container"></div>
    </body>
</html>
